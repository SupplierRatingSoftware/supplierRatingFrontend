<div class="supplier-form-container">
  <h4 class="mb-4">Neue Bestellung erfassen</h4>

  <form [formGroup]="orderForm" (ngSubmit)="onSubmit()" novalidate>
    <div ngbAccordion>
      <div ngbAccordionItem [collapsed]="false">
        <h2 ngbAccordionHeader>
          <button ngbAccordionButton type="button">1. Allgemeine Information</button>
        </h2>
        <div ngbAccordionCollapse>
          <div ngbAccordionBody>
            <ng-template>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="shortName" class="form-label">Kurzname der Bestellung *</label>
                  <input
                    type="text"
                    id="shortName"
                    class="form-control"
                    formControlName="shortName"
                    placeholder="z.B. IT-Hardware 2024" />
                  @if (orderForm.get('shortName')?.invalid && orderForm.get('shortName')?.touched) {
                  <small class="text-danger">Der Kurzname ist erforderlich.</small>
                  }
                </div>
                <div class="col-md-6 mb-3">
                  <label for="details" class="form-label">Genauere Bezeichnung (Details)</label>
                  <input
                    type="text"
                    id="details"
                    class="form-control"
                    formControlName="details"
                    placeholder="Projekt XYZ" />
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="mainCategory" class="form-label">Hauptkategorie</label>
                  <select id="mainCategory" class="form-select" formControlName="mainCategory">
                    <option value="Hardware">Hardware</option>
                    <option value="Software">Software</option>
                    <option value="Service">Dienstleistung</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="subCategory" class="form-label">Unterkategorie</label>
                  <select id="subCategory" class="form-select" formControlName="subCategory">
                    <option value="Notebooks">Notebooks</option>
                    <option value="Lizenzen">Lizenzen</option>
                    <option value="Consulting">Beratung</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="rhythm" class="form-label">Rhythmus der Bestellung</label>
                  <input type="text" id="rhythm" class="form-control" formControlName="rhythm" />
                </div>
              </div>
              <div class="mb-3">
                <label for="reason" class="form-label">Grund der Bestellung</label>
                <textarea id="reason" class="form-control" formControlName="reason" rows="2"></textarea>
              </div>
            </ng-template>
          </div>
        </div>
      </div>

      <div ngbAccordionItem>
        <h2 ngbAccordionHeader>
          <button ngbAccordionButton type="button">3. Ansprechperson beim Lieferanten</button>
        </h2>
        <div ngbAccordionCollapse>
          <div ngbAccordionBody>
            <ng-template>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="contactName" class="form-label">Name Ansprechperson</label>
                  <input type="text" id="contactName" class="form-control" formControlName="contactName" />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="contactEmail" class="form-label">Email</label>
                  <input type="email" id="contactEmail" class="form-control" formControlName="contactEmail" />
                  @if (orderForm.get('contactEmail')?.invalid && orderForm.get('contactEmail')?.touched) {
                  <small class="text-danger">Bitte eine g체ltige E-Mail eingeben.</small>
                  }
                </div>
              </div>
              <div class="mb-3">
                <label for="contactPhone" class="form-label">Telefonnummer</label>
                <input type="tel" id="contactPhone" class="form-control" formControlName="contactPhone" />
              </div>
              <div class="mb-3">
                <label for="contactComment" class="form-label">Kommentar</label>
                <textarea id="contactComment" class="form-control" formControlName="contactComment" rows="2"></textarea>
              </div>
            </ng-template>
          </div>
        </div>
      </div>

      <div ngbAccordionItem>
        <h2 ngbAccordionHeader>
          <button ngbAccordionButton type="button">4. Bewertung</button>
        </h2>
        <div ngbAccordionCollapse>
          <div ngbAccordionBody>
            <ng-template>
              @for (field of [ {id: 'ratingQuality', label: 'Qualit채t', comment: 'commentQuality'}, {id: 'ratingCost',
              label: 'Kosten/Preis', comment: 'commentCost'}, {id: 'ratingDeadline', label: 'Termineinhaltung', comment:
              'commentDeadline'}, {id: 'ratingAvailability', label: 'Verf체gbarkeit Ansprechperson', comment:
              'commentAvailability'} ]; track field.id) {
              <div class="row align-items-center mb-3">
                <div class="col-md-3">
                  <label [for]="field.id" class="form-label d-block">{{field.label}}</label>
                </div>
                <div class="col-md-3 text-center">
                  <ngb-rating
                    [id]="field.id"
                    [max]="5"
                    [formControlName]="field.id"
                    class="fs-4 text-warning"></ngb-rating>
                </div>
                <div class="col-md-6">
                  <input
                    type="text"
                    [id]="field.comment"
                    class="form-control"
                    [formControlName]="field.comment"
                    placeholder="Begr체ndung" />
                </div>
              </div>
              }
              <hr />
              <div class="row align-items-center mb-3">
                <div class="col-md-6">
                  <span class="form-label">Ergebnis Gesamtbewertung</span>
                </div>
                <div class="col-md-6 text-end">
                  <strong class="fs-4 text-primary">{{ totalRating() }}</strong>
                </div>
              </div>
              <div class="mb-3">
                <label for="totalComment" class="form-label">Gesamt-Kommentar</label>
                <textarea id="totalComment" class="form-control" formControlName="totalComment" rows="2"></textarea>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-end mt-4">
      <button type="button" class="btn btn-secondary me-2" (click)="cancel()">Abbrechen</button>
      <button type="submit" class="btn btn-primary px-5">Speichern</button>
    </div>
  </form>
</div>
